<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../views/partials/head %>
</head>

<body>
    <header>
        <% include ../views/partials/header %>
    </header>
    
    <div id="services" class="services bg-primary1" style="padding:0px">
    </div>

    <!-- jQuery -->
    <script src="javascripts/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="javascripts/bootstrap.min.js"></script>

    <script>
        var activities = <%-JSON.stringify(activitiesJSON)%>;
        var activity;   
        var urlParams = new URLSearchParams(window.location.search);
        id = urlParams.get('id');
        for(var i=0; i<activities.activities.length; i++) {
            if(activities.activities[i].id == id)
            {
                activity = activities.activities[i];
            }
        }

        var btn1 = function(id) 
        {
        window.location.href = '/chat?id='+id;
        }

        var populatePage = function(location){

            var parent = document.getElementById("services");
            var newdiv = document.createElement("div");
            newdiv.className = "container";
            newdiv.innerHTML = 
            '<div class="row text-center">'+

                ' <div class="col-xs-12 col-md-8">'+
                    ' <h2><strong>'+activity.name+'</strong></h2>'+
                    '<span><i class="material-icons" style="color:#446EB6;font-size:30px;">location_on</i>'+location+'</span>'+
                ' </div>'+

                ' <div class="col-xs-12 col-md-8" style = "padding-top:12px">'+
                    '<span>'+
                        '<img height="70" width="70" padding="6px" style = "margin-right:8px; margin-right:8px" src="images/otherUser.png"> '+
                         '<strong>'+ activity.hostName+ '</strong>'+
                    ' </span>'+                  
                ' </div>'+

                ' <div class="col-xs-12 col-md-8" style = "padding-top:10px">'+
                    ' <img height="220" width="100%" src="'+activity.pictures[0].src+'">'+
                    '<h4>'+activity.description+'</h4>'+ 
                ' </div>'+

                ' <div class="col-xs-12 col-md-8 text-center" style = "padding-top:14px">'+                        
                        '<table id="tagtable" width="100%">'+
                        '</table>'+

                ' </div>'+

                ' <div class="col-xs-12 col-md-8" style = "padding-top:18px">'+
                        ' <a style="color:white; width:100%; border-radius: 0;" href="#" onclick=\'btn1('+activity.id+')\' class="btn btn-lg btn-light1"><i class="fa fa-comments" style="color:white; font-size:20px" aria-hidden="true"></i> Chat with '+
                        activity.hostName+
                        '</a>'+                
                ' </div>'+                            

            ' </div>';
            parent.append(newdiv);

            var taghtml = '<tr id="divwithtags">';
            var divstyle;
            var istyle;
            for(var i=0; i<activity.filters.length; i++) {
                if(activity.filters[i].value == 1)
                {
                    divstyle="box-shadow: 2px 4px 8px 2px rgba(0,0,0,0.1); border-style:solid; border-color:#446EB6; background-color:#446EB6; padding-top: 6px; padding-bottom: 6px; margin: 2px;";
                    istyle="color:white; font-size:40px";
                }
                else
                {
                    divstyle="background-color:rgba(68, 110, 182, 0.31); padding-top: 6px; padding-bottom: 6px; margin: 2px;";
                    istyle="color:#446EB6; opacity:0.3; font-size:40px";
                }

                if(activity.filters[i].name=="childsafe")
                {
                   taghtml+= '<td id="childDiv" style="max-width: 40px;" width:"20%"">'+
                                    '<div style="'+divstyle+'"> <i id="childi" class="fa fa-child" aria-hidden="true" style="'+istyle+'"></i></div> Childsafe'+
                                '</td>';
                }
                else if(activity.filters[i].name=="alcohol")
                {
                    taghtml+= '<td id="alcoholDiv" style="max-width: 40px;" width:"20%"">'+
                                    '<div style="'+divstyle+'"> <i id="alcoholi" class="fa fa-glass" aria-hidden="true" style="'+istyle+'"></i></div> Alcohol'+
                                '</td>';
                    
                }
                else if(activity.filters[i].name=="food")
                {
                    taghtml+='<td id="foodDiv" style="max-width: 40px;" width:"20%"">'+
                                    '<div style="'+divstyle+'"> <i id="foodi" class="fa fa-cutlery" aria-hidden="true" style="'+istyle+'"></i></div> Food'+
                                '</td>';

                }
                else if(activity.filters[i].name=="outdoor")
                {
                    taghtml+='<td id="outdoorsDiv" style="max-width: 40px;" width:"20%"">'+
                                    '<div style="'+divstyle+'"> <i id="outdoorsi" class="fa fa-tree" aria-hidden="true" style="'+istyle+'"></i></div> Outdoors'+
                                '</td>';
                    
                }
                
            }
            taghtml+= '</tr>';
            document.getElementById("tagtable").innerHTML+= taghtml;
        }


        //populatePage();


        function displayLocation(latitude,longitude){
        var request = new XMLHttpRequest();

        var method = 'GET';
        var url = 'http://maps.googleapis.com/maps/api/geocode/json?latlng='+latitude+','+longitude+'&sensor=true';
        var async = true;

        request.open(method, url, async);
        request.onreadystatechange = function(){
          if(request.readyState == 4 && request.status == 200){
            var data = JSON.parse(request.responseText);
            var address = data.results[0];
            var location = address.formatted_address;
            populatePage(location);
          }
        };
        request.send();
        };

        displayLocation(activity.location.lat,activity.location.lng);

    </script>

    <script>
          var goBack = function()
          {
            window.location.href = '/'
          }
    </script>

</body>

</html>
