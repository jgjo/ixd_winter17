<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../views/partials/head %>
</head>
<body>
    <header>
        <% include ../views/partials/header %>
    </header>
    <link rel="stylesheet" href="stylesheets/addActivityImg.css">
    <div style="text-align: center">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-lg-offset-3 col-sm-8 col-sm-offset-2">
                    <h4>Add Activity</h4>
                  <form id="addActivityForm">

                    <div id="addmomentbtn">
                      <img id='img-upload' src="http://c.dryicons.com/images/icon_sets/shine_icon_set/png/256x256/image_add.png" class="img-thumbnail"/>

                      <div class="input-group" style="margin: 15px">
                          <span class="input-group-addon"><i class="fa fa-picture-o" aria-hidden="true"></i></span>
                          <input id="picUploadText" type="text" class="form-control" placeholder="add picture ">
                      </div>
                    </div>

                      <div class="input-group" style="margin: 15px">
                        <span class="input-group-addon"><i class="fa fa-globe" aria-hidden="true"></i></span>
                        <input id="user" type="text" class="form-control" name="name" value="" placeholder="activity name" required>
                      </div>

                      <div class="input-group" style="margin: 15px">
                        <span class="input-group-addon"><i class="fa fa-info-circle" aria-hidden="true"></i></span>
                        <input id="desc" type="text" class="form-control" name="description" placeholder="description" required>
                      </div>

                      <div class="input-group" style="margin: 15px">
                        <span class="input-group-addon"><i class="fa fa-map-marker" aria-hidden="true"></i></span>
                        <input id="user" type="text" class="form-control" name="location" placeholder="location" required>
                      </div>

                      <div class="input-group" style="margin: 15px">
                        <span class="input-group-addon"><i class="fa fa-usd" aria-hidden="true"></i></span>
                        <input id="user" type="number" class="form-control" name="maxCost" value="" placeholder="maximum cost" required>
                      </div>

                      <div class="input-group" style="margin: 15px">
                        <span class="input-group-addon"><i class="fa fa-clock-o" aria-hidden="true"></i></span>
                        <select class="form-control" id="timeSelect" name="time">
                          <option>30 mins</option>
                          <option>1 hr</option>
                          <option>2 hrs</option>
                          <option>3 hrs</option>
                          <option>5 hrs</option>
                          <option>8 hrs</option>
                        </select>
                      </div>

                        <label>Choose Tags</label>
                        <div class="input-group" style="margin: 5px 20px;">
                          <span class="input-group-addon"><i class="fa fa-child" aria-hidden="true"></i></span>
                          <input type="checkbox" class="form-control" name="childsafe">
                          <span class="input-group-addon"><i class="fa fa-tree" aria-hidden="true"></i></span>
                          <input type="checkbox" class="form-control" name="outdoor">
                          <span class="input-group-addon"><i class="fa fa-beer" aria-hidden="true"></i></span>
                          <input type="checkbox" class="form-control" name="alcohol">
                          <span class="input-group-addon"><i class="fa fa-cutlery" aria-hidden="true"></i></span>
                          <input type="checkbox" class="form-control" name="food">
                        </div>
                        <div class="row" style="margin: 0px 10px;">
                          <div class="col-lg-3 col-xs-3 col-sm-3">Childproof</div>
                          <div class="col-lg-3 col-xs-3 col-sm-3">Outdoors</div>
                          <div class="col-lg-3 col-xs-3 col-sm-3">Alcohol</div>
                          <div class="col-lg-3 col-xs-3 col-sm-3">Food</div>
                        </div>
                      <!-- Accent-colored raised button with ripple -->
                      <button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="background-color:#446EB6">SUBMIT</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- <div class="container">
      <div id="activitydiv" style="text-align: center; text-transform: uppercase; padding: 10px; font-size: 20px; color: #555">
      </div>
    </div> -->


    <!-- The Modal -->
    <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <a id="addpicbtn" class="show" onclick="showModalImage()"><img src="https://res.cloudinary.com/din6mjlbd/image/upload/v1488516490/takeAPicture_fiogit.png"></img></a>
        <img id="addmomentimg" class="hide" height="180" width="100%" src="https://res.cloudinary.com/din6mjlbd/image/upload/v1487322946/dummy_host_cbgagu.jpg"></img>
        <br/><br/>
        <input id="txt_caption" placeholder="caption" type="text" style="width:100%;"/>
        <br/><br/>
        <button id="savemomentbtn" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" style="background-color:#446EB6; border-radius: 45px; width: 30%;">
          Save
        </button>
      </div>
    </div>

    <script>
      $(document).ready( function() {
        $(document).on('change', '.btn-file :file', function() {
          var input = $(this),
            label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
          input.trigger('fileselect', [label]);
        });

        $('.btn-file :file').on('fileselect', function(event, label) {

          var input = $(this).parents('.input-group').find(':text'),
            log = label;

          if( input.length ) {
            input.val(log);
          } else {
            if( log ) alert(log);
          }

        });
        function readURL(input) {
          if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
              $('#img-upload').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
          }
        }

        $("#imgInp").change(function(){
          readURL(this);
        });
      });
    </script>

    <script>
      var showModalImage = function()
      {
        addpicbtn
        document.getElementById("addmomentimg").className = "show";
        document.getElementById("addpicbtn").className = "hide";
      }
      var hideModalImage = function()
      {
        document.getElementById("addmomentimg").className = "hide";
        document.getElementById("addpicbtn").className = "show";
      }
    </script>

    <script>
      // Get the modal
      var modal = document.getElementById('myModal');

      // Get the button that opens the modal
      var btn = document.getElementById("addmomentbtn");

      //Save and Close Button
      var savebtn = document.getElementById("savemomentbtn");


      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      // When the user clicks on the button, open the modal
      btn.onclick = function() {
        //var openModal = function() {
        modal.style.display = "block";
        ga("send", "event", "clickAdd", "addMoment");
      }

      // When the user clicks on <span> (x), close the modal
      span.onclick = function() {
        modal.style.display = "none";
      }

      savebtn.onclick = function() {
        modal.style.display = "none";

        hideModalImage();
        document.getElementById("img-upload").src = document.getElementById("addmomentimg").src;
        document.getElementById("picUploadText").placeholder = "change picture";
        //populateMoment(document.getElementById("txt_caption").value);


      }


      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
    </script>

    <script>
          var goBack = function()
          {
            window.location.href = '/'
          }
    </script>

    <script>
          var btn1 = function() 
          {            
            window.alert("Location changes (happens with a map plugin)");
          }

          $('#addActivityForm').submit(function (event) {
            event.preventDefault();
            var formData = $(this).serializeObject();
            /*
            console.log(formData);
            console.log(formData.name);
            console.log(formData.description);
            console.log(formData.location);
            console.log(formData.maxCost);
            console.log(formData.time);
            console.log(!!formData.childsafe);
            console.log(!!formData.outdoor);
            console.log(!!formData.alcohol);
            console.log(!!formData.food);
            */
            var data = {
              name: formData.name,
              description: formData.description,
              location: formData.location,
              maxCost: formData.maxCost,
              maxTimeInMin: formData.time,
              childsafe: !!formData.childsafe,
              outdoor: !!formData.outdoor,
              alcohol: !!formData.alcohol,
              food: !!formData.food
            };
            $.post('/api/activity', data, function success() {
              window.location.href = '/';
            });
          });
    </script>
  </body>
</html>
