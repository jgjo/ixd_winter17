<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../views/partials/head %>

    <!-- Google Maps -->
    <style>
         #map {
           width: 100%;
           height: 550px;
           background-color: grey;
         }
    </style>
</head>

<body>
<div>
    <header>
        <% include ../views/partials/hamburger %>
        <% include ../views/partials/header %>
    </header>

    <div id="wrapper">

       <!-- Google map -->
       <div id="google_map">
            <div id="map"></div>
       </div>

        <!-- Add activity and filter buttons overlayed on map -->
        <div id="over_map" width="100%" height="500px">
          <div class="row">
            <div class="col-lg-12 text-center" style="margin: 5px 5px;">
              <a class="btn btn-lg btn-light" style="color: darkcyan;" onclick='addclick()'><i class="fa fa-plus" aria-hidden="true"></i></a>
            </div>
            <div class="col-lg-12 text-center" style="margin: 5px 5px;">
              <a class="btn btn-lg btn-light" style="color: darkcyan;" onclick='filterclick()'><i class="fa fa-filter" aria-hidden="true"></i></a>
            </div>
          </div>
        </div>


        <!--     <div id="activityDiv" style="text-align: center, color: grey">
            <p>PAINT WITH WINE!</p><br>
            <p>Ann Paul</p>
            <button onclick="activityclick()">View Activity</button>
        </div> -->

    </div>
</div>

    <!-- Bootstrap Core JavaScript -->
    <script src="javascripts/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script>
        // Closes the sidebar menu
        $("#menu-close").click(function(e) {
            e.preventDefault();
            $("#sidebar-wrapper").toggleClass("active");
        });
        // Opens the sidebar menu
        $("#menu-toggle").click(function(e) {
            e.preventDefault();
            $("#sidebar-wrapper").toggleClass("active");
        });
        // Scrolls to the selected menu item on the page
        $(function() {
            $('a[href*=#]:not([href=#],[data-toggle],[data-target],[data-slide])').click(function() {
                if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') || location.hostname == this.hostname) {
                    var target = $(this.hash);
                    target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                    if (target.length) {
                        $('html,body').animate({
                            scrollTop: target.offset().top
                        }, 1000);
                        return false;
                    }
                }
            });
        });
        //#to-top button appears after scrolling
        var fixed = false;
        $(document).scroll(function() {
            if ($(this).scrollTop() > 250) {
                if (!fixed) {
                    fixed = true;
                    // $('#to-top').css({position:'fixed', display:'block'});
                    $('#to-top').show("slow", function() {
                        $('#to-top').css({
                            position: 'fixed',
                            display: 'block'
                        });
                    });
                }
            } else {
                if (fixed) {
                    fixed = false;
                    $('#to-top').hide("slow", function() {
                        $('#to-top').css({
                            display: 'none'
                        });
                    });
                }
            }
        });
    </script>

    <!-- Custom css -->
    <script src="javascripts/index.js"></script>

    <!-- Maps -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdV_CqEBtoB4xae7DEXjtsHSCTZOZI9m0&callback=initMap">
    </script>

    <script>
        var map;
        var activities =<%-JSON.stringify(activitiesJSON)%>
        var ownactivities =<%-JSON.stringify(ownactivitiesJSON)%>

        function initMap() {
          var center = {lat: 32.715738, lng: -117.161084};
          map = new google.maps.Map(document.getElementById('map'), {
            zoom: 13,
            center: center
          });

          addMarkers("446EB6");
          //addOwnActivityMarkers("A9A9A9");
        }

        // function addMarkers(color)
        // {

        //     var pinColor = color;
        //     var pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
        //     new google.maps.Size(21, 34),
        //     new google.maps.Point(0,0),
        //     new google.maps.Point(10, 34));
        //     var pinShadow = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",
        //     new google.maps.Size(40, 37),
        //     new google.maps.Point(0, 0),
        //     new google.maps.Point(12, 35));

        //   var bounds = new google.maps.LatLngBounds();
        //   var infowindow = new google.maps.InfoWindow();

        //   for(var i=0; i<activities.activities.length; i++) {
        //       var latLng = new google.maps.LatLng(activities.activities[i].location.lat,activities.activities[i].location.lng);
        //       var marker = new google.maps.Marker({
        //                       position: latLng,
        //                       map: map,
        //                       icon: pinImage
        //                    });

        //       bounds.extend(marker.position);

        //       google.maps.event.addListener(marker, 'click', (function(marker, i) {
        //         return function() {
        //           infowindow.setContent('Description');
        //           infowindow.open(map, marker);
        //         }
        //       })(marker, i));
        //   }
        // }

        function addMarkers(color)
        {
            var infowindow = new google.maps.InfoWindow();;
            

            // LOOP THROUGH ACTIVITIES TO CREATE MARKER
            for(var i=0; i<activities.activities.length; i++) {

                if(activities.activities[i].own==1)
                {
                    color="E67E22";
                }
                // CREATE PIN
                var pinColor = color;
                var pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
                new google.maps.Size(21, 34),
                new google.maps.Point(0,0),
                new google.maps.Point(10, 34));
                var pinShadow = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",
                new google.maps.Size(40, 37),
                new google.maps.Point(0, 0),
                new google.maps.Point(12, 35));

                // infowindow = new google.maps.InfoWindow({
                //   content: contentString
                // });

                var latLng = new google.maps.LatLng(activities.activities[i].location.lat,activities.activities[i].location.lng);

                var marker = new google.maps.Marker({
                          position: latLng,
                          map: map,
                          icon: pinImage,
                          shadow: pinShadow
                       });

                // marker.addListener('click', function() {
                //     infowindow.open(map, marker);
                // });

                google.maps.event.addListener(marker, 'click', (function(marker, i) {
                    return function() {
                    if(activities.activities[i].own==1)
                    {
                        infowindow.setContent('<div id="content">'+
                            '<div id="siteNotice">'+
                            '</div>'+
                            '<h1 id="firstHeading" class="firstHeading">'+activities.activities[i].name+'</h1>'+
                            '<div id="bodyContent">'+
                            '<p>'+activities.activities[i].description+'</p>'+
                            '<p>Host: '+activities.activities[i].hostName+
                            '</p>'+
                            '<img height="140" width="140" src="'+activities.activities[i].pictures[0].src+'">'+
                            '<p> </div>'+
                            '</div>');

                    }
                    else
                    {
                        infowindow.setContent('<div id="content">'+
                            '<div id="siteNotice">'+
                            '</div>'+
                            '<h1 id="firstHeading" class="firstHeading">'+activities.activities[i].name+'</h1>'+
                            '<div id="bodyContent">'+
                            '<p>'+activities.activities[i].description+'</p>'+
                            '<p>Host: '+activities.activities[i].hostName+
                            '</p>'+
                            '<img height="140" width="140" src="'+activities.activities[i].pictures[0].src+'">'+
                            '<p><br/><button onclick=activityclick('+activities.activities[i].id+')>View</button></p>'+
                            '</div>'+
                            '</div>');
                    }
                    infowindow.open(map, marker);
                    }
                })(marker, i));
            }

            // marker.addListener('click', function() {
            //     window.alert("ACTIVITY!");
            // });
        }
    </script>

</body>

</html>
