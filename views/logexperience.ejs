<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <% include ../views/partials/head %>

    <link rel="stylesheet" href="stylesheets/modal.css"> 

    <link href='http://fonts.googleapis.com/css?family=Droid+Serif|Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="stylesheets/timelinereset.css"> <!-- CSS reset -->
    <link rel="stylesheet" href="stylesheets/timelinestyle.css"> <!-- Resource style -->
    <script src="javascripts/modernizr.js"></script>
</head>
<body>
    <header>
        <% include ../views/partials/header %>
        <% include ../views/partials/back %>
    </header>

    <div class="container">

        <div id="activitydiv" style="text-align: center">
        </div>

        <div id="addmomentdiv" style="text-align: center">
              <br/>
              <a href="#" id="addmomentbtn">
                <button class="modalbtn">Add</button>
              </a>
              <br/>
              <a onclick='btn2()'>
                <button class="modalbtn">Save Experience</button>
              </a>
              <a onclick='btn3()'>
                <button class="modalbtn">Abandon Experience</button>
              </a>
        </div>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <a href="#" onclick="showModalImage()">Add a picture!</a>
        <img id="addmomentimg" class="hide" height="180" width="180" src="https://res.cloudinary.com/din6mjlbd/image/upload/v1487322946/dummy_host_cbgagu.jpg"></img>
        <br/>
        <p>Added Caption</p>
        <button id="savemomentbtn">Save</button>
      </div>
    </div>

    <section id="cd-timeline" class="cd-container">
<!--                 
        <div class="cd-timeline-block">
            <div class="cd-timeline-img cd-picture">
                <img src="img/cd-icon-picture.svg" alt="Picture">
            </div> 

            <div class="cd-timeline-content">
                <img height="180" width="180" src="images/activityimg1.jpg" alt="Picture">
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Iusto, optio.</p>
                <a href="#0" class="cd-read-more">Ann</a>
                <span class="cd-date">Jan 14</span>
            </div> 
        </div>  -->

    </section> 

    <!-- jQuery -->
    <script src="javascripts/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="javascripts/bootstrap.min.js"></script>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="javascripts/timelinemain.js"></script> <!-- Resource jQuery -->

    <script>
            var goBack = function()
            {
                window.location.href = '/chat'
            }
            var btn2 = function() 
            {
                window.alert("Experience saved!");
                window.location.href = '/';
            }

            var btn3 = function() 
            {
                  window.alert("Experience abandoned!");
                  window.location.href = '/';
            }
    </script>
    
	<script>
    	  var showModalImage = function() 
    	  {
    		document.getElementById("addmomentimg").className = "show"; 
  		  }
          var hideModalImage = function() 
          {
            document.getElementById("addmomentimg").className = "hide"; 
          }
    </script>


    <script>
        var moments =<%-JSON.stringify(momentsJSON)%>
        var momentsCount = 0;


        var activities =<%-JSON.stringify(activitiesJSON)%>
        var activity;   
        var urlParams = new URLSearchParams(window.location.search);
        id = urlParams.get('id');
        for(var i=0; i<activities.activities.length; i++) {
          if(activities.activities[i].id == id)
          {
              activity = activities.activities[i];
          }
        }

        var parent = document.getElementById("activitydiv");
        var newdiv = document.createElement("h1");
        newdiv.innerHTML = activity.name+ " with " + activity.hostName;
        parent.append(newdiv); 

        var addMoment = function(i){
            var username = "";
            if(i==0)
            {
                username = "You";
            }
            else
            {
                username = activity.hostName;
            }

            var moment = moments.moments[i];
            console.log(moment);
            var parent = document.getElementById("cd-timeline");
            var newdiv = document.createElement("div");
            newdiv.className = "cd-timeline-block";
            newdiv.innerHTML = '<div class="cd-timeline-img cd-picture"> <img src="img/cd-icon-picture.svg" alt="Picture"> </div> <div class="cd-timeline-content"> <img height="100" width="100" src="'+moment.pictureSrc+'" alt="Picture"> <p>'+moment.caption+'</p> <a href="#0" class="cd-read-more">'+username+'</a> <span class="cd-date">Jan 24</span> </div>';
            parent.insertBefore(newdiv, parent.firstChild);
        }

        var populateMoment = function()
        {
            var addResponse = Math.random();
            var rand = Math.floor(Math.random() * 3)
            addMoment(0);
            if(addResponse>0.5){
                addMoment(rand+1);
            }

        }

    </script>

    <script>
        // Get the modal
        var modal = document.getElementById('myModal');

        // Get the button that opens the modal
        var btn = document.getElementById("addmomentbtn");

        //Save and Close Button        
        var savebtn = document.getElementById("savemomentbtn");


        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on the button, open the modal 
        btn.onclick = function() {
        //var openModal = function() {        
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        savebtn.onclick = function() {
            modal.style.display = "none";
            hideModalImage();
            populateMoment();
        }


        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
</body>
</html>